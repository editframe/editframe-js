"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("camelcase-keys"),e=require("cross-fetch"),n=require("util"),r=require("os"),i=require("fs"),o=require("uuid"),a=require("form-data"),u=require("path-to-regexp"),s=require("query-string"),c=require("he"),d=require("image-to-base64"),l=require("jsdom"),f=require("child_process"),p=require("find-process"),h=require("path"),m=require("ts-mixer");function g(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var v=g(t),b=g(e),y=g(n),w=g(r),_=g(i),x=g(a),k=g(s),A=g(c),R=g(d),T=g(p),O=g(h),F=function(t,e){return F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},F(t,e)};function E(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}F(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var C,j,S,M,q,L,z,P,I=function(){return I=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},I.apply(this,arguments)};function W(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))}function B(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}!function(t){t.accept="Accept",t.authorization="Authorization",t.contentType="Content-Type",t.editframeClientId="Editframe-Client-Id",t.userAgent="User-Agent",t.xRequestedWith="X-Requested-With"}(C||(C={})),function(t){t.bearer="Bearer ",t.editframeJs="editframe.js/",t.xRequestedWithXML="XMLHttpRequest"}(j||(j={})),function(t){t.delete="delete",t.get="get",t.post="post",t.put="put"}(S||(S={})),function(t){t.description="description",t.id="id",t.name="name",t.webhook="webhook"}(M||(M={})),function(t){t.black="#000000",t.transparent="transparent",t.white="#ffffff"}(q||(q={})),function(t){t.backgroundColor="backgroundColor",t.dimensions="dimensions",t.duration="duration",t.files="files",t.layers="layers",t.metadata="metadata"}(L||(L={})),function(t){t.backgroundColor="backgroundColor",t.color="color",t.data="data",t.end="end",t.filter="filter",t.fontFamily="fontFamily",t.fontSize="fontSize",t.fontWeight="fontWeight",t.format="format",t.height="height",t.horizontalAlignment="horizontalAlignment",t.html="html",t.id="id",t.isRelative="isRelative",t.length="length",t.lineHeight="lineHeight",t.maxFontSize="maxFontSize",t.maxHeight="maxHeight",t.maxWidth="maxWidth",t.start="start",t.subtitles="subtitles",t.text="text",t.textAlign="textAlign",t.trim="trim",t.type="type",t.verticalAlignment="verticalAlignment",t.volume="volume",t.waveform="waveform",t.width="width",t.x="x",t.y="y"}(z||(z={})),function(t){t.audio="audio",t.filter="filter",t.html="html",t.image="image",t.lottie="lottie",t.subtitles="subtitles",t.text="text",t.video="video",t.waveform="waveform"}(P||(P={}));var H,D,N={center:"center",left:"left",right:"right"},G={bottom:"bottom",middle:"middle",top:"top"},V={brightness:"brightness",contrast:"contrast",fadeIn:"fadein",fadeOut:"fadeout",grayscale:"grayscale",lighten:"lighten",negative:"negative",saturation:"saturation",sobel:"sobel",vintage:"vintage"};!function(t){t.brightness="brightness",t.color="color",t.contrast="contrast",t.duration="duration",t.saturation="saturation",t.startTime="startTime"}(H||(H={})),function(t){t.filterName="filterName",t.options="options"}(D||(D={}));var Y,U,X={fill:"fill",fit:"fit",stretch:"stretch"};!function(t){t.duration="duration",t.framesPerSecond="framesPerSecond",t.page="page",t.url="url",t.withTransparentBackground="withTransparentBackground"}(Y||(Y={})),function(t){t.backgroundColor="backgroundColor",t.color="color",t.fontSize="fontSize"}(U||(U={}));var J,$,K,Q={center:"center",justify:"justify",left:"left",right:"right"},Z={bars:"bars",bricks:"bricks",curve:"curve",equalizer:"equalizer",line:"line",pixel:"pixel",roundBars:"roundBars",wave:"wave"};!function(t){t.backgroundColor="backgroundColor",t.color="color",t.style="style"}(J||(J={})),function(t){t.boolean="boolean",t.null="object",t.number="number",t.object="object",t.string="string",t[void 0]="undefined"}($||($={})),function(t){t.json="application/json"}(K||(K={}));var tt,et,nt,rt,it;!function(t){t.data="data",t.links="links",t.meta="meta"}(tt||(tt={})),function(t){t.first="first",t.last="last",t.next="next",t.prev="prev"}(et||(et={})),function(t){t.active="active",t.label="label",t.url="url"}(nt||(nt={})),function(t){t.currentPage="currentPage",t.from="from",t.lastPage="lastPage",t.links="links",t.path="path",t.perPage="perPage",t.to="to",t.total="total"}(rt||(rt={})),function(t){t.page="page",t.perPage="per_page"}(it||(it={}));var ot,at,ut,st,ct,dt,lt,ft,pt,ht={all:"/applications",get:"/applications/:id"},mt="/metadata",gt={all:"/videos",create:"/videos",get:"/videos/:id"};!function(t){t.setMuted="setMuted",t.setVolume="setVolume"}(ot||(ot={})),function(t){t.addAudio="addAudio",t.addFilter="addFilter",t.addHTML="addHTML",t.addImage="addImage",t.addLottie="addLottie",t.addSubtitles="addSubtitles",t.addText="addText",t.addVideo="addVideo",t.addWaveform="addWaveform",t.backgroundColor="backgroundColor",t.dimensions="dimensions",t.duration="duration",t.encode="encode",t.layer="layer",t.layers="layers",t.metadata="metadata",t.preview="preview",t.setLayer="setLayer",t.updateLayerAttribute="updateLayerAttribute"}(at||(at={})),function(t){t.id="id",t.status="status",t.timestamp="timestamp"}(ut||(ut={}));var vt,bt,yt,wt,_t,xt,kt=((st={})[V.brightness]=((ct={})[H.brightness]=$.number,ct),st[V.contrast]=((dt={})[H.contrast]=$.number,dt),st[V.fadeIn]=((lt={})[H.color]=$.string,lt[H.duration]=$.number,lt[H.startTime]=$.number,lt),st[V.fadeOut]=((ft={})[H.color]=$.string,ft[H.duration]=$.number,ft[H.startTime]=$.number,ft),st[V.saturation]=((pt={})[H.saturation]=$.number,pt),st);!function(t){t.setFilter="setFilter"}(vt||(vt={})),function(t){t.setHTMLOptions="setHTMLOptions"}(bt||(bt={})),function(t){t.setLength="setLength",t.setStart="setStart"}(yt||(yt={})),function(t){t.setAnimationData="setAnimationData"}(wt||(wt={})),function(t){t.setTrim="setTrim"}(_t||(_t={})),function(t){t.setIsRelative="setIsRelative",t.setX="setX",t.setY="setY"}(xt||(xt={}));var At,Rt,Tt,Ot,Ft,Et,Ct,jt,St,Mt,qt="".concat("./.preview","/config.json");!function(t){t.setDimensions="setDimensions",t.setFormat="setFormat",t.setHeight="setHeight",t.setWidth="setWidth"}(At||(At={})),function(t){t.setSubtitlesOptions="setSubtitlesOptions"}(Rt||(Rt={})),function(t){t.setColor="setColor",t.setFontFamily="setFontFamily",t.setFontSize="setFontSize",t.setFontWeight="setFontWeight",t.setLineHeight="setLineHeight",t.setMaxFontSize="setMaxFontSize",t.setMaxHeight="setMaxHeight",t.setMaxWidth="setMaxWidth",t.setText="setText",t.setTextAlignment="setTextAlignment"}(Tt||(Tt={})),function(t){t.setDimensions="setDimensions",t.setFilter="setFilter"}(Ot||(Ot={})),function(t){t.setBackgroundColor="setBackgroundColor",t.setColor="setColor",t.setDimensions="setDimensions",t.setFilter="setFilter",t.setFormat="setFormat",t.setHeight="setHeight",t.setWidth="setWidth",t.setX="setX",t.setY="setY"}(Ft||(Ft={})),function(t){t.downloadUrl="downloadUrl",t.duration="duration",t.id="id",t.isFailed="isFailed",t.isReady="isReady",t.metadata="metadata",t.streamUrl="streamUrl",t.thumbnailUrl="thumbnailUrl",t.timestamp="timestamp"}(Et||(Et={})),function(t){t.all="all",t.get="get",t.getMetadata="_getMetadata",t.new="new"}(Ct||(Ct={})),function(t){t.bitrate="bitrate",t.codec="codec",t.duration="duration",t.fps="fps",t.height="height",t.size="size",t.width="width"}(jt||(jt={})),function(t){t.type="type"}(St||(St={})),function(t){t.audio="audio",t.image="image",t.video="video"}(Mt||(Mt={}));var Lt=function(t,e){return"".concat(t," - ").concat(e)},zt=function(t){return"Error getting applications: ".concat(t)},Pt="malformed `applications` response";function It(t,e){return t(e={exports:{}},e.exports),e.exports}var Wt=It((function(t){var e={};t.exports=e;var n={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgGrey:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(n).forEach((function(t){var r=n[t],i=e[t]=[];i.open="["+r[0]+"m",i.close="["+r[1]+"m"}))})),Bt=function(t,e){var n=(e=e||process.argv).indexOf("--"),r=/^-{1,2}/.test(t)?"":"--",i=e.indexOf(r+t);return-1!==i&&(-1===n||i<n)},Ht=process.env,Dt=void 0;function Nt(t){var e=function(t){if(!1===Dt)return 0;if(Bt("color=16m")||Bt("color=full")||Bt("color=truecolor"))return 3;if(Bt("color=256"))return 2;if(t&&!t.isTTY&&!0!==Dt)return 0;var e=Dt?1:0;if("win32"===process.platform){var n=w.default.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(n[0])>=10&&Number(n[2])>=10586?Number(n[2])>=14931?3:2:1}if("CI"in Ht)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some((function(t){return t in Ht}))||"codeship"===Ht.CI_NAME?1:e;if("TEAMCITY_VERSION"in Ht)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Ht.TEAMCITY_VERSION)?1:0;if("TERM_PROGRAM"in Ht){var r=parseInt((Ht.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Ht.TERM_PROGRAM){case"iTerm.app":return r>=3?3:2;case"Hyper":return 3;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Ht.TERM)?2:/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(Ht.TERM)||"COLORTERM"in Ht?1:(Ht.TERM,e)}(t);return function(t){return 0!==t&&{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}(e)}Bt("no-color")||Bt("no-colors")||Bt("color=false")?Dt=!1:(Bt("color")||Bt("colors")||Bt("color=true")||Bt("color=always"))&&(Dt=!0),"FORCE_COLOR"in Ht&&(Dt=0===Ht.FORCE_COLOR.length||0!==parseInt(Ht.FORCE_COLOR,10));var Gt,Vt=Nt,Yt=(Nt(process.stdout),Nt(process.stderr),It((function(t){t.exports=function(t,e){var n="";t=(t=t||"Run the trap, drop the bass").split("");var r={a:["@","Ą","Ⱥ","Ʌ","Δ","Λ","Д"],b:["ß","Ɓ","Ƀ","ɮ","β","฿"],c:["©","Ȼ","Ͼ"],d:["Ð","Ɗ","Ԁ","ԁ","Ԃ","ԃ"],e:["Ë","ĕ","Ǝ","ɘ","Σ","ξ","Ҽ","੬"],f:["Ӻ"],g:["ɢ"],h:["Ħ","ƕ","Ң","Һ","Ӈ","Ԋ"],i:["༏"],j:["Ĵ"],k:["ĸ","Ҡ","Ӄ","Ԟ"],l:["Ĺ"],m:["ʍ","Ӎ","ӎ","Ԡ","ԡ","൩"],n:["Ñ","ŋ","Ɲ","Ͷ","Π","Ҋ"],o:["Ø","õ","ø","Ǿ","ʘ","Ѻ","ם","۝","๏"],p:["Ƿ","Ҏ"],q:["্"],r:["®","Ʀ","Ȑ","Ɍ","ʀ","Я"],s:["§","Ϟ","ϟ","Ϩ"],t:["Ł","Ŧ","ͳ"],u:["Ʊ","Ս"],v:["ט"],w:["Ш","Ѡ","Ѽ","൰"],x:["Ҳ","Ӿ","Ӽ","ӽ"],y:["¥","Ұ","Ӌ"],z:["Ƶ","ɀ"]};return t.forEach((function(t){t=t.toLowerCase();var e=r[t]||[" "],i=Math.floor(Math.random()*e.length);n+=void 0!==r[t]?r[t][i]:t})),n}}))),Ut=It((function(t){t.exports=function(t,e){t=t||"   he is here   ";var n={up:["̍","̎","̄","̅","̿","̑","̆","̐","͒","͗","͑","̇","̈","̊","͂","̓","̈","͊","͋","͌","̃","̂","̌","͐","̀","́","̋","̏","̒","̓","̔","̽","̉","ͣ","ͤ","ͥ","ͦ","ͧ","ͨ","ͩ","ͪ","ͫ","ͬ","ͭ","ͮ","ͯ","̾","͛","͆","̚"],down:["̖","̗","̘","̙","̜","̝","̞","̟","̠","̤","̥","̦","̩","̪","̫","̬","̭","̮","̯","̰","̱","̲","̳","̹","̺","̻","̼","ͅ","͇","͈","͉","͍","͎","͓","͔","͕","͖","͙","͚","̣"],mid:["̕","̛","̀","́","͘","̡","̢","̧","̨","̴","̵","̶","͜","͝","͞","͟","͠","͢","̸","̷","͡"," ҉"]},r=[].concat(n.up,n.down,n.mid);function i(t){return Math.floor(Math.random()*t)}function o(t){var e=!1;return r.filter((function(n){e=n===t})),e}return function(t,e){var r,a,u="";for(a in(e=e||{}).up=void 0===e.up||e.up,e.mid=void 0===e.mid||e.mid,e.down=void 0===e.down||e.down,e.size=void 0!==e.size?e.size:"maxi",t=t.split(""))if(!o(a)){switch(u+=t[a],r={up:0,down:0,mid:0},e.size){case"mini":r.up=i(8),r.mid=i(2),r.down=i(8);break;case"maxi":r.up=i(16)+3,r.mid=i(4)+1,r.down=i(64)+3;break;default:r.up=i(8)+1,r.mid=i(6)/2,r.down=i(8)+1}var s=["up","mid","down"];for(var c in s)for(var d=s[c],l=0;l<=r[d];l++)e[d]&&(u+=n[d][i(n[d].length)])}return u}(t,e)}})),Xt=It((function(t){t.exports=function(t){return function(e,n,r){if(" "===e)return e;switch(n%3){case 0:return t.red(e);case 1:return t.white(e);case 2:return t.blue(e)}}}})),Jt=It((function(t){t.exports=function(t){return function(e,n,r){return n%2==0?e:t.inverse(e)}}})),$t=It((function(t){t.exports=function(t){var e=["red","yellow","green","blue","magenta"];return function(n,r,i){return" "===n?n:t[e[r++%e.length]](n)}}})),Kt=It((function(t){t.exports=function(t){var e=["underline","inverse","grey","yellow","red","green","blue","white","cyan","magenta","brightYellow","brightRed","brightGreen","brightBlue","brightWhite","brightCyan","brightMagenta"];return function(n,r,i){return" "===n?n:t[e[Math.round(Math.random()*(e.length-2))]](n)}}})),Qt=It((function(t){var e={};t.exports=e,e.themes={};var n=e.styles=Wt,r=Object.defineProperties,i=new RegExp(/[\r\n]+/g);e.supportsColor=Vt,void 0===e.enabled&&(e.enabled=!1!==e.supportsColor()),e.enable=function(){e.enabled=!0},e.disable=function(){e.enabled=!1},e.stripColors=e.strip=function(t){return(""+t).replace(/\x1B\[\d+m/g,"")},e.stylize=function(t,r){if(!e.enabled)return t+"";var i=n[r];return!i&&r in e?e[r](t):i.open+t+i.close};var o=/[|\\{}()[\]^$+*?.]/g;function a(t){var e=function t(){return d.apply(t,arguments)};return e._styles=t,e.__proto__=c,e}var u,s=(u={},n.grey=n.gray,Object.keys(n).forEach((function(t){n[t].closeRe=new RegExp(function(t){if("string"!=typeof t)throw new TypeError("Expected a string");return t.replace(o,"\\$&")}(n[t].close),"g"),u[t]={get:function(){return a(this._styles.concat(t))}}})),u),c=r((function(){}),s);function d(){var t=Array.prototype.slice.call(arguments),r=t.map((function(t){return null!=t&&t.constructor===String?t:y.default.inspect(t)})).join(" ");if(!e.enabled||!r)return r;for(var o=-1!=r.indexOf("\n"),a=this._styles,u=a.length;u--;){var s=n[a[u]];r=s.open+r.replace(s.closeRe,s.open)+s.close,o&&(r=r.replace(i,(function(t){return s.close+t+s.open})))}return r}e.setTheme=function(t){if("string"!=typeof t)for(var n in t)!function(n){e[n]=function(r){if("object"==typeof t[n]){var i=r;for(var o in t[n])i=e[t[n][o]](i);return i}return e[t[n]](r)}}(n);else console.log("colors.setTheme now only accepts an object, not a string.  If you are trying to set a theme from a file, it is now your (the caller's) responsibility to require the file.  The old syntax looked like colors.setTheme(__dirname + '/../themes/generic-logging.js'); The new syntax looks like colors.setTheme(require(__dirname + '/../themes/generic-logging.js'));")};var l=function(t,e){var n=e.split("");return(n=n.map(t)).join("")};for(var f in e.trap=Yt,e.zalgo=Ut,e.maps={},e.maps.america=Xt(e),e.maps.zebra=Jt(e),e.maps.rainbow=$t(e),e.maps.random=Kt(e),e.maps)!function(t){e[t]=function(n){return l(e.maps[t],n)}}(f);r(e,function(){var t={};return Object.keys(s).forEach((function(e){t[e]={get:function(){return a([e])}}})),t}())})),Zt=It((function(t){t.exports=Qt})),te={clientIdAndTokenRequired:"\\".concat(Zt.white("clientId"),"\\ and \\").concat(Zt.white("token"),"\\ must be provided to constructor")},ee=function(t){return"\\".concat(Zt.white(t),"\\ is not valid url")},ne=function(t,e,n,r){return"\n  \\".concat(Zt.white(e),"\\ attribute in \\").concat(Zt.white(t),"\\ must be of type \\").concat(Zt.white(r),"\\. Got: \\").concat(Zt.white(JSON.stringify(n)),"\\")},re=function(t){return t.join(" | ")},ie=function(t){return"\\".concat(Zt.white(t),"\\ field is required")},oe=function(t,e){return"".concat(t,": { ").concat(e," }")},ae={dataRequired:"\\".concat(Zt.white("data"),"\\ must be provided"),dimensionsRequired:"\\".concat(Zt.white("dimensions"),"\\ must be provided unless a \\").concat(Zt.white("videoFile"),"\\ is provided"),durationRequired:"\\".concat(Zt.white("duration"),"\\ must be provided unless a \\").concat(Zt.white("videoFile"),"\\ is provided"),errorEncoding:function(t){return"Error encoding video: ".concat(t)},filterRequired:"\\".concat(Zt.white("filter"),"\\ must be provided"),htmlPageOrURLRequired:"Either \\".concat(Zt.white("page"),"\\ or \\").concat(Zt.white("url"),"\\ must be provided"),malformedEncodingResponse:"malformed ".concat(Zt.white("encoding"),"\\ response"),optionsRequired:"\\".concat(Zt.white("options"),"\\ must be provided"),textRequired:"\\".concat(Zt.white("text"),"\\ field required"),validationOptionsError:function(t){return"Error: ".concat(t)}},ue="Invalid file source provided",se=function(t){return"Invalid layer format: ".concat(t)},ce=function(t){return"Error getting videos: ".concat(t)},de=function(t){return"Error getting video: ".concat(t)},le="malformed `videos` response",fe=function(t){return"Error creating new video: ".concat(t)},pe=function(t,e){return"".concat(t,"/v").concat(e)},he=function(t){return function(e){return e.url.startsWith("/")?b.default("".concat(t).concat(e.url),e):b.default(e.url,e)}},me=function(t){return function(e){var n=e.data,r=e.headers,i=e.method,o=e.url;return W(void 0,void 0,void 0,(function(){var e,a,u;return B(this,(function(s){switch(s.label){case 0:return[4,t({body:n,headers:r,method:i,url:o})];case 1:if(!(e=s.sent()).ok)throw new Error(Lt(e.url,e.statusText));return[4,e.json()];case 2:return a=s.sent(),!(u=v.default(a,{deep:!0})).data||u.links||u.meta?[2,u]:[2,u.data]}}))}))}},ge=function(t){var e,n=t.clientId,r=t.isForm,i=void 0!==r&&r,o=t.token,a=((e={})[C.userAgent]="".concat(j.editframeJs).concat("0.2.4"),e[C.editframeClientId]=n,e[C.authorization]="".concat(j.bearer).concat(o),e);return i?(a[C.accept]=K.json,a[C.xRequestedWith]=j.xRequestedWithXML):a[C.contentType]=K.json,a},ve=function(t,e){if(t&&e.validate(t))return t;throw new Error(e.invalidDataError)},be=function(t){return console.error(Zt.yellow(t))},ye=function(t,e){return Array.isArray(e)?e.includes(typeof t):typeof t===e},we=function(t){try{new URL(t)}catch(e){throw new TypeError(ee(t))}},_e=function(t,e){if(!t)throw new Error(e)},xe=function(t,e,n,r,i){if(void 0===i&&(i=!1),n&&typeof n!==r){var o=ne(t,e,n,r);if(i)throw new TypeError(o);return o}},ke=function(t,e){try{return t(),e?e():void 0}catch(t){t.name;var n=t.stack;be(n),process.exit(1)}},Ae=function(t){return nt.active in t&&ye(t.active,$.boolean)&&nt.label in t&&ye(t.label,$.string)},Re=function(t,e){return tt.data in t&&Array.isArray(t.data)&&(!(t.data.length>0)||t.data.every(e))&&tt.links in t&&(r=t.links,et.first in r&&ye(r.first,$.string)&&et.last in r&&ye(r.last,$.string))&&tt.meta in t&&(n=t.meta,rt.currentPage in n&&ye(n.currentPage,$.number)&&rt.from in n&&ye(n.from,[$.number,$.null])&&rt.lastPage in n&&ye(n.lastPage,$.number)&&rt.links in n&&n.links.every(Ae)&&rt.path in n&&ye(n.path,$.string)&&rt.perPage in n&&ye(n.perPage,$.string)&&rt.to in n&&ye(n.to,[$.number,$.null])&&rt.total in n&&ye(n.total,$.number));var n,r},Te=function(t){return M.description in t&&ye(t.description,$.string)&&M.id in t&&ye(t.id,$.string)&&M.name in t&&ye(t.name,$.string)&&M.webhook in t&&ye(t.webhook,$.string)},Oe=function(t){return Re(t,Te)},Fe=function(){return o.v4().slice(0,6)},Ee=function(t){i.existsSync(t)||i.mkdirSync(t,{recursive:!0})},Ce=function(t){return _.default.createReadStream(t)},je=function(t){return i.existsSync(t)},Se=function(t){return typeof t===$.string?"url":"file"},Me=function(t,e){return void 0===t&&(t="/"),void 0===e&&(e={}),"/"===t?t:function(t){return u.compile(t)}(t)(e,{pretty:!0})},qe=function(t,e,n){var r;return function(t,e){var n=k.default.stringify(e);return"".concat(t).concat(n?"?".concat(n):"")}(t,((r={})[it.page]=e,r[it.perPage]=n,r))},Le=function(t){return A.default.unescape(A.default.escape(t))},ze=function(t){return t&&[1,2,3].includes(Object.keys(t).length)&&H.color in t&&H.duration in t&&H.startTime in t&&ye(t[H.color],[$.string,$.undefined])&&ye(t[H.duration],$.number)&&ye(t[H.startTime],[$.number,$.undefined])},Pe=((Gt={})[V.brightness]=function(t){return t&&1===Object.keys(t).length&&H.brightness in t&&ye(t[H.brightness],$.number)},Gt[V.contrast]=function(t){return t&&1===Object.keys(t).length&&H.contrast in t&&ye(t[H.contrast],$.number)},Gt[V.fadeIn]=ze,Gt[V.fadeOut]=ze,Gt[V.saturation]=function(t){return t&&1===Object.keys(t).length&&H.saturation in t&&ye(t[H.saturation],$.number)},Gt),Ie=function(t,e,n,r){var i=n.filterName,o=n.options;void 0===r&&(r=!1);var a=[],u=Object.values(V).includes(i);if(!u){var s=ne(t,oe(e,D.filterName),i,"".concat(Object.values(V).join(", ")));if(r)throw new TypeError(s);a.push(s)}if(u&&i in kt&&!Pe[i](o)){s=ne(t,oe(e,D.options),o,JSON.stringify(kt[i]));if(r)throw new TypeError(s);a.push(s)}return a},We=function(t){return void 0!==t},Be=function(t,e){var n=e.horizontalAlignment,r=e.verticalAlignment,i=[];return i.push(Ve(t,z.horizontalAlignment,n)),i.push(Ye(t,z.verticalAlignment,r)),i.filter(We)},He=function(t,e){var n=[];return n.push(xe(t,z.volume,e.volume,$.number)),n.filter(We)},De=function(t,e){var n=e.length,r=e.start,i=[];return i.push(xe(t,z.start,r,$.number)),i.push(xe(t,z.length,n,$.number)),i.filter(We)},Ne=function(t,e){var n=e.html,r=n.page,i=n.url,o=n.withTransparentBackground,a=[];return r||i||a.push(ae.htmlPageOrURLRequired),a.push(xe(t,oe(z.html,Y.page),r,$.string)),a.push(xe(t,oe(z.html,Y.withTransparentBackground),o,$.boolean)),a.push(xe(t,oe(z.html,Y.url),i,$.string)),a.filter(We)},Ge=function(t,e){var n=e.filter,r=[];return n&&Ie(t,z.filter,n).forEach((function(t){return r.push(t)})),r.filter(We)},Ve=function(t,e,n){var r=Object.values(N);if(n&&!r.includes(n))return ne(t,e,n,r.join(", "))},Ye=function(t,e,n){var r=Object.values(G);if(n&&!r.includes(n))return ne(t,e,n,r.join(", "))},Ue=function(t,e){if(e)return typeof e===$.string?Ve(t,z.x,e):xe(t,z.x,e,$.number)},Xe=function(t,e){if(e)return typeof e===$.string?Ye(t,z.y,e):xe(t,z.y,e,$.number)},Je=function(t,e){var n=Object.values(Q);if(e&&!n.includes(e))return ne(t,z.textAlign,e,n.join(", "))},$e=function(t,e){var n=e.data,r=[];return r.push(xe(t,z.data,n,$.object)),r.filter(We)},Ke=function(t,e){var n=e.x,r=e.y,i=[];return i.push(Ue(t,n)),i.push(Xe(t,r)),i.filter(We)},Qe=function(t,e){var n=e.subtitles,r=n.backgroundColor,i=n.color,o=n.fontSize,a=[];return a.push(xe(t,oe(z.subtitles,U.backgroundColor),r,$.string)),a.push(xe(t,oe(z.subtitles,U.color),i,$.string)),a.push(xe(t,oe(z.subtitles,U.fontSize),o,$.number)),a.filter(We)},Ze=function(t,e){var n=e.color,r=e.fontFamily,i=e.fontSize,o=e.maxFontSize,a=e.maxHeight,u=e.maxWidth,s=e.text,c=e.textAlign,d=[];return d.push(xe(t,z.color,n,$.string)),d.push(xe(t,z.fontFamily,r,$.string)),d.push(xe(t,z.fontSize,i,$.number)),d.push(xe(t,z.maxFontSize,o,$.number)),d.push(xe(t,z.maxHeight,a,$.number)),d.push(xe(t,z.maxWidth,u,$.number)),d.push(xe(t,z.text,s,$.string)),d.push(Je(t,c)),d.filter(We)},tn=function(t,e){var n=e.trim,r=[];return r.push(xe(t,oe(z.trim,z.start),null==n?void 0:n.start,$.number)),r.push(xe(t,oe(z.trim,z.end),null==n?void 0:n.end,$.number)),r.filter(We)},en=function(t,e){var n=e.backgroundColor,r=e.format,i=e.x,o=e.y,a=[];return a.push(xe(t,z.backgroundColor,n,$.string)),a.push(function(t,e,n){var r=Object.values(X);if(n&&!r.includes(n))return ne(t,e,n,r.join(", "))}(t,z.format,r)),a.push(Ue(t,i)),a.push(Xe(t,o)),a.filter(We)},nn=function(t,e){var n=e.waveform,r=n.backgroundColor,i=n.color,o=n.style,a=[];a.push(xe(t,J.backgroundColor,r,$.string)),a.push(xe(t,J.color,i,$.string)),a.push(xe(t,J.style,o,$.string));var u=Object.values(Z);return o&&!u.includes(o)&&a.push(ne(t,J.style,o,u.join(", "))),a.filter(We)},rn=function(t,e,n){var r=t.map((function(t){return t(e,n)})).flat().filter((function(t){return void 0!==t}));if(r.length)throw new TypeError("Validation Errors: ".concat(r.join("\n")))},on=function(t){return W(void 0,void 0,void 0,(function(){return B(this,(function(e){switch(e.label){case 0:return je("./.preview")?f.execSync("git pull",{cwd:O.default.resolve("./.preview"),stdio:[0,1,2]}):(Ee("./.preview"),f.execSync("git clone https://github.com/editframe/editframe-preview .",{cwd:O.default.resolve("./.preview"),stdio:[0,1,2]})),n=qt,r=t,i.writeFileSync(n,r),[4,T.default("port","9876")];case 1:return e.sent().length||f.execSync("cd ".concat("./.preview","; yarn; yarn dev"),{cwd:O.default.resolve("./.preview"),stdio:[0,1,2]}),[2]}var n,r}))}))},an=function(t){return ut.id in t&&ye(t[ut.id],$.string)&&ut.status in t&&ye(t[ut.status],$.string)&&ut.timestamp in t&&ye(t[ut.timestamp],$.number)},un=function(t){return Et.id in t&&ye(t.id,$.string)&&Et.isReady in t&&ye(t.isReady,$.boolean)&&Et.isFailed in t&&ye(t.isFailed,$.boolean)},sn=function(t){return Re(t,un)},cn=function(t){return jt.bitrate in t&&ye(t.bitrate,$.number)&&jt.codec in t&&ye(t.codec,$.string)&&jt.duration in t&&ye(t.duration,$.number)&&jt.fps in t&&ye(t.fps,$.number)&&jt.height in t&&ye(t.height,$.number)&&jt.size in t&&ye(t.size,$.number)&&jt.width in t&&ye(t.width,$.number)},dn=function(){function t(t){this._options=I({},t),this._fetch=t.fetch}return t.prototype.get=function(t){var e=t.url;return W(this,void 0,void 0,(function(){return B(this,(function(t){switch(t.label){case 0:return[4,this._fetch({headers:ge(this._options),url:e})];case 1:return[2,t.sent()]}}))}))},t.prototype.post=function(t){var e=t.data,n=t.isForm,r=void 0!==n&&n,i=t.url;return W(this,void 0,void 0,(function(){return B(this,(function(t){switch(t.label){case 0:return[4,this._fetch({data:e,headers:ge(I(I({},this._options),{isForm:r})),method:S.post,url:i})];case 1:return[2,t.sent()]}}))}))},t.prototype.put=function(t){var e=t.data,n=t.isForm,r=void 0!==n&&n,i=t.url;return W(this,void 0,void 0,(function(){return B(this,(function(t){switch(t.label){case 0:return[4,this._fetch({data:e,headers:ge(I(I({},this._options),{isForm:r})),method:S.put,url:i})];case 1:return[2,t.sent()]}}))}))},t}(),ln=function(){function t(t){this._api=t}return t.prototype.all=function(t,e){return W(this,void 0,void 0,(function(){var n,r;return B(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._api.get({url:qe(ht.all,t,e)})];case 1:return n=i.sent(),[2,ve(n,{invalidDataError:Pt,validate:Oe}).data];case 2:return r=i.sent(),console.error(zt(r.message)),[3,3];case 3:return[2,[]]}}))}))},t.prototype.get=function(t){return W(this,void 0,void 0,(function(){var e,n;return B(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._api.get({url:Me(ht.get,{id:t})})];case 1:return e=r.sent(),[2,ve(e,{invalidDataError:Pt,validate:Te})];case 2:return n=r.sent(),console.error(zt(n.message)),[3,3];case 3:return[2,void 0]}}))}))},t}(),fn=function(){function t(t){var e=t.composition,n=t.id;this._composition=e,this._id=n}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),t.prototype[yt.setStart]=function(t){var e=this;return ke((function(){return xe(yt.setStart,z.start,t,$.number,!0)}),(function(){return e._updateAttribute(z.start,t)}))},t.prototype[yt.setLength]=function(t){var e=this;return ke((function(){return xe(yt.setLength,z.length,t,$.number,!0)}),(function(){return e._updateAttribute(z.length,t)}))},t.prototype._updateAttribute=function(t,e){return this._composition.updateLayerAttribute(this._id,t,e),this},t}(),pn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return E(e,t),e.prototype[_t.setTrim]=function(t){var e=this,n=t.end,r=t.start;ke((function(){_e(r,ie(z.start)),xe(_t.setTrim,z.start,r,$.number,!0),xe(_t.setTrim,z.end,n,$.number,!0)}),(function(){return e._updateAttribute(z.start,r<0?0:r),n&&e._updateAttribute(z.end,n),e}))},e}(fn),hn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return E(e,t),e.prototype[ot.setVolume]=function(t){var e=this;return ke((function(){_e(t,ie(z.volume)),xe(ot.setVolume,z.volume,t,$.number,!0)}),(function(){var n=t;return t>1?n=1:t<0&&(n=0),e._updateAttribute(z.volume,n)}))},e.prototype[ot.setMuted]=function(){return this._updateAttribute(z.volume,0)},e}(pn),mn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return E(e,t),e.prototype[vt.setFilter]=function(t){var e=this,n=t.filterName,r=t.options;return ke((function(){return Ie(vt.setFilter,z.filter,{filterName:n,options:r},!0)}),(function(){return e._updateAttribute(z.filter,{filterName:n,options:r})}))},e}(fn),gn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return E(e,t),e.prototype[xt.setIsRelative]=function(t){var e=this;void 0===t&&(t=!1),ke((function(){return xe(xt.setIsRelative,z.isRelative,t,$.boolean,!0)}),(function(){return e._updateAttribute(z.isRelative,t)}))},e.prototype[xt.setX]=function(t){var e=this;ke((function(){return Ue(xt.setX,t)}),(function(){return e._updateAttribute(z.x,t)}))},e.prototype[xt.setY]=function(t){var e=this;ke((function(){return Xe(xt.setY,t)}),(function(){return e._updateAttribute(z.y,t)}))},e}(pn),vn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return E(e,t),e.prototype[At.setDimensions]=function(t){var e=this,n=t.height,r=t.width;ke((function(){_e(n,ie(z.height)),_e(r,ie(z.width))}),(function(){return e._updateAttribute(z.height,n),e._updateAttribute(z.width,r)}))},e.prototype[At.setFormat]=function(t){var e=this;ke((function(){return function(t){if(!Object.values(X).includes(t))throw new TypeError(se(t))}(t)}),(function(){return e._updateAttribute(z.format,t)}))},e.prototype[At.setHeight]=function(t){var e=this;ke((function(){return xe(At.setHeight,z.height,t,$.number,!0)}),(function(){return e._updateAttribute(z.height,t)}))},e.prototype[At.setWidth]=function(t){var e=this;ke((function(){return xe(At.setWidth,z.width,t,$.number,!0)}),(function(){return e._updateAttribute(z.width,t)}))},e}(pn),bn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return E(e,t),e.prototype[Ft.setBackgroundColor]=function(t){var e=this;ke((function(){return xe(Ft.setBackgroundColor,z.backgroundColor,t,$.string,!0)}),(function(){return e._updateAttribute(z.backgroundColor,t)}))},e.prototype[Ft.setFilter]=function(t){var e=this,n=t.filterName,r=t.options;ke((function(){return Ie(Ft.setFilter,z.filter,{filterName:n,options:r},!0)}),(function(){return e._updateAttribute(z.filter,{filterName:n,options:r})}))},e}(m.Mixin(pn,gn,vn)),yn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return E(e,t),e.prototype[bt.setHTMLOptions]=function(t){var e=this;ke((function(){var e;return Ne(bt.setHTMLOptions,((e={})[z.html]=t,e))}),(function(){return e._updateAttribute(z.html,t)}))},e}(bn),wn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return E(e,t),e.prototype[wt.setAnimationData]=function(t){try{return _e(t,ie(z.data)),xe(wt.setAnimationData,z.data,t,$.object),this._updateAttribute(z.data,t)}catch(t){var e=t.stack;be(e)}},e}(bn),_n=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return E(e,t),e.prototype[Rt.setSubtitlesOptions]=function(t){var e=this;ke((function(){var e;return Qe(Rt.setSubtitlesOptions,((e={})[z.subtitles]=t,e))}),(function(){return e._updateAttribute(z.subtitles,t)}))},e}(gn),xn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return E(e,t),e.prototype[Tt.setColor]=function(t){var e=this;ke((function(){return xe(Tt.setColor,z.color,t,$.string,!0)}),(function(){return e._updateAttribute(z.color,t)}))},e.prototype[Tt.setFontFamily]=function(t){var e=this;return ke((function(){return xe(Tt.setFontFamily,z.fontFamily,t,$.string,!0)}),(function(){return e._updateAttribute(z.fontFamily,t)}))},e.prototype[Tt.setFontSize]=function(t){var e=this;return ke((function(){return xe(Tt.setFontSize,z.fontSize,t,$.number,!0)}),(function(){return e._updateAttribute(z.fontSize,t)}))},e.prototype[Tt.setFontWeight]=function(t){var e=this;return ke((function(){return function(t,e,n,r,i){if(void 0===i&&(i=!1),n&&!r.includes(typeof n)){var o=ne(t,e,n,re(r));if(i)throw new TypeError(o);return o}}(Tt.setFontWeight,z.fontWeight,t,[$.number,$.string],!0)}),(function(){return e._updateAttribute(z.fontWeight,t)}))},e.prototype[Tt.setLineHeight]=function(t){var e=this;return ke((function(){return xe(Tt.setLineHeight,z.lineHeight,t,$.number,!0)}),(function(){return e._updateAttribute(z.lineHeight,t)}))},e.prototype[Tt.setMaxFontSize]=function(t){var e=this;ke((function(){return xe(Tt.setMaxFontSize,z.maxFontSize,t,$.number,!0)}),(function(){return e._updateAttribute(z.maxFontSize,t)}))},e.prototype[Tt.setMaxHeight]=function(t){var e=this;ke((function(){return xe(Tt.setMaxHeight,z.maxHeight,t,$.number,!0)}),(function(){return e._updateAttribute(z.maxHeight,t)}))},e.prototype[Tt.setMaxWidth]=function(t){var e=this;ke((function(){return xe(Tt.setMaxWidth,z.maxWidth,t,$.number,!0)}),(function(){return e._updateAttribute(z.maxWidth,t)}))},e.prototype[Tt.setText]=function(t){var e=this;ke((function(){_e(t,ae.textRequired),xe(Tt.setText,z.text,t,$.string,!0)}),(function(){return e._updateAttribute(z.text,t)}))},e.prototype[Tt.setTextAlignment]=function(t){var e=this;ke((function(){return Je(Tt.setTextAlignment,t)}),(function(){return e._updateAttribute(z.textAlign,t)}))},e}(bn),kn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return E(e,t),e}(m.Mixin(hn,bn)),An=function(){function t(t){var e=this,n=t.api,r=t.formData,i=t.options;this._layers=[],this._api=n,this._files=[],this._formData=r,this._options=i,ke((function(){return function(t){var e=t.backgroundColor,n=t.dimensions,r=t.duration,i=[];_e(r,ae.durationRequired),_e(n,ae.dimensionsRequired),i.push(xe(Ct.new,oe(L.dimensions,z.height),n.height,$.number)),i.push(xe(Ct.new,oe(L.dimensions,z.width),n.width,$.number)),i.push(xe(Ct.new,L.backgroundColor,e,$.string));var o=i.filter((function(t){return void 0!==t}));if(o.length)throw new TypeError(o.join("\n"))}(e._options)}))}return Object.defineProperty(t.prototype,at.backgroundColor,{get:function(){return this._options.backgroundColor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,at.dimensions,{get:function(){return this._options.dimensions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,at.duration,{get:function(){return this._options.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,at.metadata,{get:function(){return this._options.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,at.layers,{get:function(){return this._layers},enumerable:!1,configurable:!0}),t.prototype[at.layer]=function(t){return this._layers.find((function(e){return e.id&&e.id===t}))},t.prototype[at.addAudio]=function(t,e){var n=this;return void 0===e&&(e={}),ke((function(){_e(t,ue),_e(e,ae.optionsRequired),function(t){rn([De,tn,He],at.addAudio,t)}(e)}),(function(){var r=n._addLayer(I({type:P.audio},e)).id;return n._files.push({file:t,id:r}),new hn({composition:n,id:r})}))},t.prototype[at.addFilter]=function(t){var e=this;return ke((function(){_e(t,ae.optionsRequired),_e(t.filter,ae.filterRequired),function(t){rn([De,Ge],at.addFilter,t)}(t)}),(function(){var n=e._addLayer(I(I({},t),{type:P.filter})).id;return new mn({composition:e,id:n})}))},t.prototype[at.addHTML]=function(t){return W(this,void 0,void 0,(function(){var e=this;return B(this,(function(n){switch(n.label){case 0:return[4,(r=function(){_e(t,ae.optionsRequired),function(t){rn([De,en,Ge,Ne],at.addHTML,t)}(t)},i=function(){return W(e,void 0,void 0,(function(){var e,n,r,i,o,a,u,s;return B(this,(function(c){switch(c.label){case 0:return e=t.height,n=t.html,r=n.page,i=n.withTransparentBackground,o=t.width,a=I({},t),r?(u=a.html,[4,(d=r,W(void 0,void 0,void 0,(function(){var t,e,n,r,i,o,a,u,s,c,f,p;return B(this,(function(h){switch(h.label){case 0:for(t=new l.JSDOM(d.slice()).window.document,e=t.getElementsByTagName("script"),n=t.querySelectorAll("img"),r=0,i=e;r<i.length;r++)i[r].remove();o=0,a=n,h.label=1;case 1:return o<a.length?(u=a[o],[".","/"].includes(u.src[0])?(c=(s=u).setAttribute,f=["src"],p="data:image/png;base64,".concat,[4,R.default(u.src)]):[3,3]):[3,4];case 2:c.apply(s,f.concat([p.apply("data:image/png;base64,",[h.sent()])])),h.label=3;case 3:return o++,[3,1];case 4:return[2,Le(t.documentElement.outerHTML)]}}))})))]):[3,2];case 1:u.page=c.sent(),c.label=2;case 2:return e||(a.height=this._options.dimensions.height),o||(a.width=this._options.dimensions.width),void 0===i&&(a.html.withTransparentBackground=!1),s=this._addLayer(I(I({},a),{type:P.html})).id,[2,new yn({composition:this,id:s})]}var d}))}))},W(void 0,void 0,void 0,(function(){var t,e;return B(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),r(),i?[4,i()]:[3,2];case 1:return[2,n.sent()];case 2:return[2,void 0];case 3:return t=n.sent(),e=t.stack,be(e),process.exit(1),[3,4];case 4:return[2]}}))})))];case 1:return[2,n.sent()]}var r,i}))}))},t.prototype[at.addImage]=function(t,e){var n=this;return ke((function(){_e(t,ue),_e(e,ae.optionsRequired),function(t){rn([De,en,Ge],at.addImage,t)}(e)}),(function(){var r=n._addLayer(I({type:P.image},e)).id;return n._files.push({file:t,id:r}),new kn({composition:n,id:r})}))},t.prototype[at.addLottie]=function(t){var e=this;return ke((function(){_e(t,ae.optionsRequired),_e(t.data,ae.dataRequired),function(t){rn([De,en,$e],at.addLottie,t)}(t)}),(function(){var n=e._addLayer(I({type:P.lottie},t)).id;return new wn({composition:e,id:n})}))},t.prototype[at.addSubtitles]=function(t,e){var n=this;return void 0===e&&(e={subtitles:{}}),ke((function(){_e(t,ue),function(t){rn([De,Ke,Qe],at.addSubtitles,t)}(e)}),(function(){var r=n._addLayer(I({type:P.subtitles},e)).id;return n._files.push({file:t,id:r}),new _n({composition:n,id:r})}))},t.prototype[at.addText]=function(t){var e=this;return ke((function(){_e(t,ae.optionsRequired),_e(t.text,ae.textRequired),function(t){rn([De,en,Be,Ze],at.addText,t)}(t)}),(function(){var n=e._addLayer(I({type:P.text},t)).id;return new xn({composition:e,id:n})}))},t.prototype[at.addVideo]=function(t,e){var n=this;return void 0===e&&(e={}),ke((function(){_e(t,ue),_e(e,ae.optionsRequired),function(t){rn([De,tn,He,en],at.addVideo,t)}(e)}),(function(){var r=n._addLayer(I({type:P.video},e)).id;return n._files.push({file:t,id:r}),new kn({composition:n,id:r})}))},t.prototype[at.addWaveform]=function(t,e){var n=this;return void 0===t&&(t={}),ke((function(){_e(t,ae.optionsRequired),function(t){rn([De,en,nn],at.addWaveform,t)}(t)}),(function(){var r=n._addLayer(I({type:P.waveform},t)).id;return e&&n._files.push({file:e,id:r}),new bn({composition:n,id:r})}))},t.prototype[at.preview]=function(){return W(this,void 0,void 0,(function(){return B(this,(function(t){switch(t.label){case 0:return[4,on(JSON.stringify(I(I({},this._options),{files:this._files,layers:this._layers})))];case 1:return t.sent(),[2]}}))}))},t.prototype[at.encode]=function(){return W(this,void 0,void 0,(function(){var t,e;return B(this,(function(n){switch(n.label){case 0:this._generateConfig(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._api.post({data:this._formData,isForm:!0,url:gt.create})];case 2:return t=n.sent(),[2,ve(t,{invalidDataError:ae.malformedEncodingResponse,validate:an})];case 3:return e=n.sent(),console.error(ae.errorEncoding(e.message)),[2,void 0];case 4:return[2]}}))}))},t.prototype._generateConfig=function(){var t=this;this._files.forEach((function(e){var n=e.file,r=e.id;return t._formData.append(function(t,e){return"".concat(Se(t)).concat(e)}(n,r),n)})),this._formData.append("config",JSON.stringify(I(I({},this._options),{layers:this._layers})))},t.prototype._addLayer=function(t){var e=I({id:Fe()},t);return this._layers.push(e),e},t.prototype[at.updateLayerAttribute]=function(t,e,n){var r=I({},this.layer(t));r[e]=n,this.setLayer(t,r)},t.prototype[at.setLayer]=function(t,e){var n=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}([],this.layers,!0),r=n.findIndex((function(e){return e.id===t}));n[r]=e,this._layers=n},t}(),Rn=function(){function t(t){this._api=t}return t.prototype[Ct.all]=function(t,e){return W(this,void 0,void 0,(function(){var n,r;return B(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._api.get({url:qe(gt.all,t,e)})];case 1:return n=i.sent(),[2,ve(n,{invalidDataError:le,validate:sn}).data];case 2:return r=i.sent(),console.error(ce(r.message)),[3,3];case 3:return[2,[]]}}))}))},t.prototype[Ct.get]=function(t){return W(this,void 0,void 0,(function(){var e,n;return B(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._api.get({url:Me(gt.get,{id:t})})];case 1:return e=r.sent(),[2,ve(e,{invalidDataError:le,validate:un})];case 2:return n=r.sent(),console.error(de(n.message)),[3,3];case 3:return[2,void 0]}}))}))},t.prototype[Ct.new]=function(t,n){return void 0===t&&(t={backgroundColor:q.black}),W(this,void 0,void 0,(function(){var r,o,a,u,s,c,d,l,f,p,h,m,g,v,b;return B(this,(function(y){switch(y.label){case 0:return y.trys.push([0,7,,8]),r=void 0,n?(o=void 0,a=void 0,u=void 0,function(t){try{return we(t),!0}catch(t){return!1}}(n)?[4,(_=n,W(void 0,void 0,void 0,(function(){var t,n,r,o;return B(this,(function(a){switch(a.label){case 0:return t="./tmp/".concat(Fe()),n="".concat(t,"/").concat(Fe()),Ee(t),[4,e.fetch(_)];case 1:return r=a.sent(),o=i.createWriteStream(n),[4,new Promise((function(t,e){r.body.pipe(o),r.body.on("error",e),o.on("finish",t)}))];case 2:return a.sent(),[2,{temporaryFileDirectory:t,temporaryFilePath:n}]}}))})))]:[3,2]):[3,5];case 1:return s=y.sent(),c=s.temporaryFileDirectory,d=s.temporaryFilePath,u=c,o=Ce(d),a=Ce(d),[3,3];case 2:o=Ce(n),a=Ce(n),y.label=3;case 3:return[4,this._getMetadata(o)];case 4:return l=y.sent(),g=l.duration,f=l.height,p=l.width,(r=new An({api:this._api,formData:new x.default,options:I(I({},t),{dimensions:{height:f,width:p},duration:g})})).addVideo(a),je(w=u)&&i.rmdirSync(w,{recursive:!0}),[3,6];case 5:h=t.backgroundColor,m=t.dimensions,g=t.duration,v=t.metadata,r=new An({api:this._api,formData:new x.default,options:{backgroundColor:h,dimensions:m,duration:g,metadata:v}}),y.label=6;case 6:return[2,r];case 7:return b=y.sent(),console.error(fe(b.message)),[3,8];case 8:return[2,void 0]}var w,_}))}))},t.prototype[Ct.getMetadata]=function(t){return W(this,void 0,void 0,(function(){var e,n;return B(this,(function(r){switch(r.label){case 0:return e=function(t){var e=new x.default;return t.forEach((function(t){e.append(t[0],t[1])})),e}([[Se(t),t],[St.type,Mt.video]]),[4,this._api.post({data:e,isForm:!0,url:mt})];case 1:return n=r.sent(),[2,ve(n,{invalidDataError:le,validate:cn})]}}))}))},t}(),Tn=function(){function t(t){var e,n=t.clientId,r=t.host,i=void 0===r?"https://api.editframe.com":r,o=t.token,a=t.version,u=void 0===a?2:a;if(!n||!o)throw new Error(te.clientIdAndTokenRequired);this._api=new dn({clientId:n,fetch:(e=pe(i,u),me(he(e))),host:i,token:o,version:u}),this._clientId=n,this._host=i,this._token=o,this._version=u,this.applications=new ln(this._api),this.videos=new Rn(this._api)}return Object.defineProperty(t.prototype,"clientId",{get:function(){return this._clientId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),t}(),On={_1080p:{height:1080,width:1920},_1080pVertical:{height:1920,width:1080},_1080x1080:{height:1080,width:1080},_720p:{height:720,width:1080},_720pVertical:{height:1080,width:720},_720x720:{height:720,width:720}};exports.CommonResolutions=On,exports.Editframe=Tn;
//# sourceMappingURL=index.js.map
